本文已参与「新人创作礼」活动，一起开启掘金创作之路

前面我们已经搭建好了一个基础的前端工程项目，并且针对 Vite 做好了相应的配置，其实除去项目业务内容，已经算是一个完整的小项目啦！

现在我们开始为 HuoHuo-Admin 的核心开发做一些重要的前置工作，也即围绕 Vue3 的周边生态为我们的项目框架搭建地面结构。

# 初始代码清理

开始写我们的核心代码之前，需要先把项目自带的部分代码或文件删除，主要就是我们的 src 文件。

![image-20220512101120381](https://gitee.com/huohuomua/pictures/raw/master/202205121011444.png)

env.d.ts 定义类型的文件放到 types 中，并重命名为 shims-vue.d.ts，帮助我们告诉 TS，Vue 文件的一些类型。

在根目录下的 index.html 文件中更改 title 并将 favicon.ico 换成自己的小 logo!

![image-20220512104948996](https://gitee.com/huohuomua/pictures/raw/master/202205121049025.png)

# src 构建

也就是围绕 Vue3 生态对项目技术栈使用的构建，这里我们依然从 src 目录来看是如何构建的（一般项目通用 src 目录）。

## api 接口文件

通常我们会把所有的接口方法统一放到这个模块中，并在该模块下根据实际的业务需求分别管理对应的接口。比如 api 文件夹下某个文件夹里面包含的接口对应某个页面（特定页面中使用到了这些特定接口），或者某个文件对应某个业务流。

比如 vben 中的结构：

![image-20220512113701178](https://gitee.com/huohuomua/pictures/raw/master/202205121137213.png)

## assets 静态资源文件

这个文件跟 public 文件一般都用来放外面的图标图片，主要区别就是是否会被构建，assets 里的文件是会被构建的。建议分层管理区分不同用途：icons、images、svg

![image-20220512114344033](https://gitee.com/huohuomua/pictures/raw/master/202205121143057.png)

## components 文件

前端项目中使用最多的就是组件，我们不仅想复用它们，更想让我们的页面代码更加的结构化、模块化。比如我们有一个页面，我们只让页面告诉我们这里有几个 item（页面结构），页面是由什么组成的。纯页面代码只需要做到这些就行了，这样可以让我们的代码更清晰，item 与 item 之间相互分离，各司其职。而具体的 item 是什么样，做什么，我们都放到组件里面来，让它们做好自己就行了！

> 首先我们还需要明确一点，src 目录下的 components 文件一般设计成全局组件供多个页面使用，使用上区别于我们有时候在页面文件中为了达到将该特定页面进行模块化拆分的 components 文件（局部组件）。那么这里这个组件文件该怎么设计呢？

不用想太多，这不是有现成的吗？Element 惊人的的 Star 数量就不需要多说，针对 Vue3 的组件库进化版 Element-Plus 也已经被广泛地使用，并处于高速发展的状态。所以组件怎么做，看 Element-Plus 就够了，比如，表单组件的文件结构：

![image-20220512115915624](https://gitee.com/huohuomua/pictures/raw/master/202205121159658.png)

可以看到，一个组件主要包括核心的 src 文件和注册文件 index.ts。至于引入的样式 style 文件，EP(Element-Plus 简称)主要是引入其源码中的特定 CSS。我们项目中只是为页面做的组件，而非组件库，这个文件其实可以不要，或者说，有更合适的解决方案（之后会涉及到）。

> src 内组件的业务代码我们暂时不需要去关注，我们看看 EP 是怎么注册组件的。

```ts
// form 组件的 index.ts
import { withInstall, withNoopInstall } from "@element-plus/utils/with-install";
import Form from "./src/form.vue";
import FormItem from "./src/form-item.vue";

export const ElForm = withInstall(Form, {
  FormItem,
});

export default ElForm;

export const ElFormItem = withNoopInstall(FormItem);
```

EP 使用了经过封装的组件注册函数 withInstall、withNoopInstall，看一下 EP 相关源码：

![image-20220512151134279](https://gitee.com/huohuomua/pictures/raw/master/202205121511369.png)

EP 团队考虑的情况比我们一般的组件注册要复杂的多，我们可以简化一下：

```ts
// src/utils/withInstall.ts
import type { App, Plugin } from "vue";

export const withInstall = <T>(component: T, alias?: string) => {
  const comp = component as any;
  comp.install = (app: App) => {
    app.component(comp.name, component);
    if (alias) {
      app.config.globalProperties[alias] = component;
    }
  };
  return component as T & Plugin;
};
```

注册

```ts
// src\components\ReTest\src\test.vue
import { withInstall } from "/@/utils/withInstall";
import test from "./src/test.vue";

export const Test = withInstall(test);
```

使用

![image-20220512194943660](https://gitee.com/huohuomua/pictures/raw/master/202205121949748.png)

> 如果你使用的是 setup，那就方便多了。我们只需要在 script 标签中添加 setup，我们不需要对组件进行注册，不需要指定组件名字（setup 会自动帮我们以文件名作为组件名），也不需要写 export default，相当于就是写一个 vue 文件了。

![image-20220512202213570](https://gitee.com/huohuomua/pictures/raw/master/202205122022639.png)

具体的封装案例会在后面出专门的一篇讲解组件的设计与封装思路，届时内容会包含多种 Vue3 组件的封装方式，除了主流 setup，还会有 jsx 写法哦！

## config 项目配置

做一些项目逻辑处理，比如项目的全局配置、界面设置

## directives 指令封装

Vue3 指令的封装

## layouts 项目布局

项目的各种布局开发

## plugins 项目插件配置

这里主要是引入一些开发中需要用到的插件，并进行自定义配置，比如 ECharts、Element-Plus、Vxe-table、i18n...

## router 项目路由

项目的路由采用 Vue-Router

## store 状态管理

状态管理我们不再使用以前常用的 Vuex，而是使用 Pinia

## style 样式库

项目的大部分样式都放在这里，包括 CSS 初始化文件、插件样式更改文件、自定义样式等

## utils 方法库

存放着整个项目中使用到的具有一定功能性的工具方法的库

## views 页面

我们的页面部分

## App.vue

项目的根组件，是页面的入口文件，实际上所有的单页面都在该页面下进行切换。

## main.ts

项目应用的入口文件，项目所有的依赖都从这里引进，始终服务于后面的开发。
